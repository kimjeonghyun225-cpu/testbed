## QA 디바이스 자동 추출 시스템 v2 — 운영 사용자 가이드

본 문서는 호환성 QA 업무의 “디바이스 선정/추출”을 표준화하기 위해, Streamlit 기반 **QA 디바이스 자동 추출 시스템 v2**의 사용 방법과 운영 유의사항을 정리한 문서입니다.

---

## 1. 대상 및 범위

### 1.1 대상
- 호환성 QA 담당자(주 사용자)
- 개발/PM(비전공자 포함) — 결과 확인 및 커뮤니케이션 목적

### 1.2 범위
- 정책 선택/관리(생성·수정·삭제)
- 디바이스 마스터 업로드(Excel/CSV)
- Rank 목표 수량 입력 → 추출 실행 → 결과/엑셀 다운로드

---

## 2. 사전 준비

### 2.1 권장 환경(배포)
- Streamlit Cloud

### 2.2 API 키(선택)
- 본인이 직접 설정합니다(조직 내 보안 정책 준수).
- 배포 환경에서는 `local.env` 저장/유지가 보장되지 않으므로 **Streamlit Secrets** 사용을 권장합니다.

예시(Secrets):

```toml
OPENAI_API_KEY="sk-..."
OPENAI_MODEL="gpt-4.1-mini"
JIRA_BASE_URL="https://xxx.atlassian.net"
JIRA_EMAIL="your@email.com"
JIRA_API_TOKEN="..."
```

---

## 3. 사용 시나리오(표준 흐름)

### 3.1 정책 선택
1) 좌측에서 정책을 선택합니다.
- 운영 기본 정책: `KP`, `KRJP`, `PALM`

2) 필요 시 정책 관리 화면에서 정책을 생성/수정할 수 있습니다.

### 3.2 디바이스 마스터 업로드
1) 좌측 업로드 영역에 Excel/CSV를 업로드합니다.
2) 업로드된 파일은 내부 표준 컬럼으로 정규화됩니다(예: `rank`, `cpu`, `gpu`, `ram_gb`, `platform`, `available` 등).

### 3.3 Rank 목표 수량 입력
1) 플랫폼(AOS/iOS)을 선택합니다.
2) Rank별 목표 수량(A+, A, B, C, D 등)을 입력합니다.

### 3.4 (선택) 제외/필수 입력
- **제외할 타겟 국가(중복 선택)**: 특정 타겟 국가를 후보에서 제외합니다.
- **제외할 NOTE(중복 선택)**: 특정 NOTE 값을 가진 행을 후보에서 제외합니다.
- **필수 디바이스 No(콤마, 선택)**: 입력한 No는 조건과 무관하게 결과에 포함됩니다.
- **직전 버전 제외 No(콤마, 선택)**: 입력한 No는 어떤 경우에도 결과에 포함되지 않습니다.

### 3.5 추출 실행
1) `자동 추출 실행`을 누릅니다.
2) 결과는 플랫폼별 탭(Android(AOS)/iOS)으로 표시됩니다.

### 3.6 다운로드
- `엑셀 다운로드(멀티시트)`로 결과를 다운로드합니다.

---

## 4. 정책 관리(생성/수정/삭제)

### 4.1 정책 생성
- `새 정책 만들기`에서 정책 YAML을 생성하고 저장합니다.

### 4.2 정책 수정
- `수정`에서 기존 정책 YAML을 수정하고 저장(덮어쓰기)합니다.

### 4.3 정책 삭제
- `삭제` 버튼으로 정책 파일을 삭제할 수 있습니다(확인 단계 포함).

### 4.4 배포 환경 유의사항(중요)
- Streamlit Cloud의 파일시스템은 재배포/재시작 시 초기화될 수 있습니다.
- 따라서 배포 환경에서 생성/수정한 정책을 “운영 정책으로 확정”하려면, 최종 YAML을 별도 보관하고 Git에 반영하는 방식을 권장합니다.

---

## 5. 자주 묻는 질문(FAQ)

### Q1. “필수 디바이스 No”를 넣었는데 결과에서 안 보입니다.
- 결과 표는 화면 크기/표시 제한으로 일부만 보일 수 있습니다.
- 필수 디바이스는 결과 표 상단에 고정 표시되므로, 다시 실행 후 상단에서 확인합니다.

### Q2. 목표 수량을 채웠는데도 “중복 허용”이 발생합니다.
- 후보 수(또는 유니크 스펙)가 부족하면 목표 수량을 맞추기 위해 제한을 완화할 수 있습니다.

---

## 6. 용어 정리(간단)
- **정책(YAML)**: 후보 필터/중복 제거/다양성/타이브레이커 등 “선정 규칙” 정의
- **Rank 목표 수량**: Rank별로 뽑아야 하는 기기 수
- **필수 No**: 어떤 조건보다 우선하여 반드시 포함해야 하는 기기
- **직전 버전 제외 No**: 어떤 조건보다 우선하여 반드시 제외해야 하는 기기

